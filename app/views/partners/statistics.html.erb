<% @nav_class[:statistics] = :current -%>
<h1>Voter Application Reports</h1>
<div class="text">
  <p>
    Keep track of how your voter registration tool is doing and find out who is using it.
    <%= RockyConf.sponsor.partner_comarketing_text.html_safe %>
  </p>
</div>
  <div class="form_downloadcsv">
    <fieldset>
      <legend>Download Existing Reports of Registrant Data</legend>
      <p>You can view and download all reports you've generated within the last 30 days.</p>
      <div class='submit_button'>
        <div class="button rollover_button">
          <a class="<%= "button_downloadcsv_#{I18n.locale} button_downloadcsv"%>" href="<%= reports_partner_path(@partner)  %>">
              <span>View Existing Reports</span>
          </a>
        </div>
      </div>
    </fieldset>
  </div>
    <%= form_tag registrations_partner_path(@partner) , method: :post, :class=> 'form_downloadcsv' do %>
      <fieldset>
        <legend>Generate a New Report with Your Registration Data</legend>
        <p>Leave date fields blank if you would like to download the last 1 month of registration data.</p>
        <div class='date_inputs'>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
        </div>
        <div class='csv_type_input'>
          <%= check_box_tag :generate_extended %>
          <%= label_tag :generate_extended, 'Use Extended CSV Format' %>
          <br/>
          <span>This format includes extra columns of data, which may grow over time.</span>
        </div>
        <div class='submit_button'>
          <%= rollover_button "downloadcsv", "Generate New Report", id: "downloadcsv"%>
        </div>
      </fieldset>
    <%- end %>
    <%= form_tag canvassing_shift_report_partner_path(@partner) , method: :post, :class=> 'form_downloadcsv' do %>
      <fieldset>
        <legend>Generate a New Canvassing Shift Report</legend>
        <p>Includes all web-based shifts and any using the latest version of the tablet app.</p>
        <p>Leave date fields blank if you would like to download the last 1 month of registration data.</p>
        <div class='date_inputs'>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
        </div>
        <div class='submit_button'>
          <%= rollover_button "downloadcsv", "Generate New Report", id: "downloadcsv"%>
        </div>
      </fieldset>
    <%- end %>
    
    <%- if @partner.enabled_for_grommet? %>    
      <%= form_tag grommet_registrant_report_partner_path(@partner), method: :post, :class=> 'form_downloadcsv' do %>
        <fieldset>
          <legend>Generate a New PA Registration Report (Tablet registrants only through date TBD)</legend>
          <p>Leave date fields blank if you would like to download the last 1 month of registration data.</p>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          
          <div class='submit_button' style="clear: both">
            <%= rollover_button "downloadcsv", "Generate New PA Registrant Report", id: "downloadshiftcsv"%>
          </div>
        </fieldset>
      <%- end %>
      <%= form_tag grommet_shift_report_partner_path(@partner) , method: :post, :class=> 'form_downloadcsv' do %>
        <fieldset>
          <legend>Generate a New PA Shift Report</legend>
          <p>Leave date fields blank if you would like to download the last 1 month of registration data.</p>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          
          <div class='submit_button' style="clear: both">
            <%= rollover_button "downloadcsv", "Generate New PA Shift Report", id: "downloadshiftcsv"%>
          </div>
        </fieldset>
      <%- end %>
    <%- end %>
    <%= form_tag abr_report_partner_path(@partner), method: :post, :class=> 'form_downloadcsv' do %>
      <fieldset>
        <legend>Generate a New Absentee Request Report</legend>
        <p>Leave date fields blank to download the last month of data.</p>
        <div class='date_inputs'>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
        </div>
        <div class='submit_button'>
          <%= rollover_button "downloadcsv", "Generate New Report", id: "downloadcsv"%>
        </div>
      </fieldset>
    <%- end %>
    <%= form_tag lookup_report_partner_path(@partner) , method: :post, :class=> 'form_downloadcsv' do %>
      <fieldset>
        <legend>Generate a New Voter Status Lookup Report</legend>
        <p>Leave date fields blank to download the last month of data.</p>
        <div class='date_inputs'>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
        </div>
        <div class='submit_button'>
          <%= rollover_button "downloadcsv", "Generate New Report", id: "downloadcsv"%>
        </div>
      </fieldset>
    <%- end %>
    <%= form_tag alert_request_report_partner_path(@partner) , method: :post, :class=> 'form_downloadcsv' do %>
      <fieldset>
        <legend>Generate a new Voter Pledge Report</legend>
        <p>Leave date fields blank to download the last month of data.</p>
        <div class='date_inputs'>
          <div class='date_input'>
            <%= label_tag :start_date, 'Start Date' %>
            <%= text_field_tag 'start_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
          <div class='date_input'>
            <%= label_tag :end_date, 'End Date' %>
            <%= text_field_tag 'end_date', nil, placeholder: "mm/dd/yyyy" %>
          </div>
        </div>
        <div class='submit_button'>
          <%= rollover_button "downloadcsv", "Generate New Report", id: "downloadcsv"%>
        </div>
      </fieldset>
    <%- end %>
  

<table id="statistics" cellspacing="0">
  <tr>
    <td id="left_column">
      <%- if @stats_by_state %>
      <div class="stats" id="stats_by_state">        
        <table cellspacing="0">
          <thead><tr><th colspan="3">Applications by State</th></tr></thead>
          <tbody>
            <% @stats_by_state.each do |stat| %>
              <tr class="<%= cycle('even', 'odd') %>">
                <th><%= stat[:state_name] %></th>
                <td><%= stat[:registrations_count] %></td>
                <td><%= "%.1f" % (stat[:registrations_percentage] * 100) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <%- end %>
      
    </td>

    <td id="right_column">
      <%- if @stats_by_completion_date %>
      <%= render :partial => 'stats_by_completion_date' %>
      <%- end %>
      <%- if @stats_by_completion_date_finish_with_state %>
      <%= render :partial => 'finish_with_state_stats_by_completion_date' %>
      <%- end %>
      <% reset_cycle %>
      <%- if @stats_by_race %>
      <div class="stats" id="stats_by_race">
        <table cellspacing="0">
          <thead><tr><th colspan="3">Applications by Ethnicity</th></tr></thead>
          <tbody>
            <% @stats_by_race.each do |stat| %>
              <tr class="<%= cycle('even', 'odd') %>">
                <th><%= stat[:race] %></th>
                <td><%= stat[:registrations_count] %></td>
                <td><%= "%.1f" % (stat[:registrations_percentage] * 100) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <%- end %>

      <% reset_cycle %>
      <%- if @stats_by_gender %>
      <div class="stats" id="stats_by_gender">
        <table cellspacing="0">
          <thead><tr><th colspan="3">Applications by Gender</th></tr></thead>
          <tbody>
            <% @stats_by_gender.each do |stat| %>
              <tr class="<%= cycle('even', 'odd') %>">
                <th><%= stat[:gender] %></th>
                <td><%= stat[:registrations_count] %></td>
                <td><%= "%.1f" % (stat[:registrations_percentage] * 100) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% end %>
      <% reset_cycle %>
      <% if @stats_by_age%>
      <div class="stats" id="stats_by_age">
        <table cellspacing="0">
          <thead><tr><th colspan="3">Applications by Age</th></tr></thead>
          <tbody>
            <tr class="<%= cycle('even', 'odd') %>">
              <th>&lt; 18</th>
              <td><%= @stats_by_age[:age_under_18][:count] %></td>
              <td><%= "%.1f" % (@stats_by_age[:age_under_18][:percentage] * 100) %>%</td>
            </tr>
            <tr class="<%= cycle('even', 'odd') %>">
              <th>18-29</th>
              <td><%= @stats_by_age[:age_18_to_29][:count] %></td>
              <td><%= "%.1f" % (@stats_by_age[:age_18_to_29][:percentage] * 100) %>%</td>
            </tr>
            <tr class="<%= cycle('even', 'odd') %>">
              <th>30-39</th>
              <td><%= @stats_by_age[:age_30_to_39][:count] %></td>
              <td><%= "%.1f" % (@stats_by_age[:age_30_to_39][:percentage] * 100) %>%</td>
            </tr>
            <tr class="<%= cycle('even', 'odd') %>">
              <th>40-64</th>
              <td><%= @stats_by_age[:age_40_to_64][:count] %></td>
              <td><%= "%.1f" % (@stats_by_age[:age_40_to_64][:percentage] * 100) %>%</td>
            </tr>
            <tr class="<%= cycle('even', 'odd') %>">
              <th>65-up</th>
              <td><%= @stats_by_age[:age_65_and_up][:count] %></td>
              <td><%= "%.1f" % (@stats_by_age[:age_65_and_up][:percentage] * 100) %>%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <% end %>
      <% reset_cycle %>
      <% if @stats_by_party %>
      <div class="stats" id="stats_by_party">
        <table cellspacing="0">
          <thead><tr><th colspan="3">Applications by Party</th></tr></thead>
          <tbody>
            <% @stats_by_party.each do |stat| %>
              <tr class="<%= cycle('even', 'odd') %>">
                <th><%= stat[:party] %></th>
                <td><%= stat[:count] %></td>
                <td><%= "%.1f" % (stat[:percentage] * 100) %>%</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% end %>
    </td>
  </tr>
</table>
